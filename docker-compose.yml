# docker-compose.yml
version: "3.7"

services:
  # 1. PostgreSQL æ•°æ®åº“æœåŠ¡
  database:
    image: postgres:14
    restart: always
    environment:
      POSTGRES_USER: directus # æ•°æ®åº“ç”¨æˆ·å
      POSTGRES_PASSWORD: lantudagang2025 # æ•°æ®åº“å¯†ç 
      POSTGRES_DB: directus # æ•°æ®åº“åç§°
    volumes:
      - postgres_data:/var/lib/postgresql/data # æ•°æ®æŒä¹…åŒ–

  # 2. Directus åº”ç”¨æœåŠ¡
  directus:
    image: directus/directus:latest
    restart: always
    ports:
      - "8055:8055" # æ˜ å°„ç«¯å£ï¼šæœ¬åœ° 8055 ç«¯å£ -> å®¹å™¨ 8055 ç«¯å£
    volumes:
      - ./extensions:/directus/extensions
    environment:
      # A. åº”ç”¨é…ç½®
      HOST: "0.0.0.0" #æ¥å—æ¥è‡ªå±€åŸŸç½‘ï¼ˆæ‰‹æœºï¼‰çš„è¿æ¥ï¼Œè€Œä¸ä»…ä»…æ˜¯å®¹å™¨å†…éƒ¨
      KEY: lantudagang2025 # ğŸ’¡ å¼ºçƒˆå»ºè®®æ›¿æ¢ï¼ç”¨äºå®‰å…¨åŠ å¯†
      SECRET: 2025lantudagang # ğŸ’¡ å¼ºçƒˆå»ºè®®æ›¿æ¢ï¼ç”¨äº JWT ç­¾å
      ADMIN_EMAIL: admin@example.com
      ADMIN_PASSWORD: lantudagang2025 # åˆå§‹ç®¡ç†å‘˜å¯†ç 
      LLM_API_KEY: "sk-8c0883760c7e4748bb6ea764813dd82b"
      # B. æ•°æ®åº“è¿æ¥é…ç½® (è¿æ¥åˆ°ä¸Šé¢çš„ database æœåŠ¡)
      DB_CLIENT: pg # ä½¿ç”¨ PostgreSQL
      DB_HOST: database # ä½¿ç”¨æœåŠ¡åç§°ä½œä¸ºä¸»æœºå
      DB_PORT: 5432
      DB_DATABASE: directus
      DB_USER: directus
      DB_PASSWORD: lantudagang2025

      # C. ç¯å¢ƒå˜é‡ï¼ˆç”¨äºå¼€å‘ï¼‰
      # å…è®¸ä»ä»»ä½•æ¥æºè®¿é—® API (CORS)
      CORS_ENABLED: "true"
      CORS_ORIGIN: "http://localhost:5173"

      EXTENSIONS_AUTO_RELOAD: true # è‡ªåŠ¨é‡è½½æ‰©å±•ï¼ˆå¼€å‘æ—¶æœ‰ç”¨ï¼‰

    depends_on:
      - database # ç¡®ä¿æ•°æ®åº“å…ˆå¯åŠ¨

volumes:
  postgres_data:
